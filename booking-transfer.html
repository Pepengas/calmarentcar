<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Data Transfer Tool</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #0066cc;
            margin-bottom: 10px;
        }
        .instruction-box {
            background-color: #f8f9fa;
            border-left: 4px solid #0066cc;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .step {
            margin-bottom: 25px;
        }
        .step-title {
            font-weight: 600;
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #333;
        }
        .data-box {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            margin-bottom: 15px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        button {
            background-color: #0066cc;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0055aa;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .success {
            color: #198754;
            font-weight: 600;
        }
        .warning {
            color: #dc3545;
            font-weight: 600;
        }
        .hidden {
            display: none;
        }
        .log {
            margin-top: 20px;
            padding: 10px;
            background-color: #f0f4f8;
            border-radius: 4px;
            max-height: 150px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .log-entry {
            margin-bottom: 5px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Booking Data Transfer Tool</h1>
    <div class="instruction-box">
        This tool helps you transfer booking data from your local environment to your live website.
        Follow each step carefully to ensure the data is transferred correctly.
    </div>

    <div class="step" id="step1">
        <div class="step-title">Step 1: Extract Booking Data from Local Storage</div>
        <p>Click the button below to extract your bookings from your local browser's storage.</p>
        <button id="extract-data">Extract Data</button>
        <div id="booking-count" class="hidden">
            <p><span id="count-value" class="success">0</span> bookings found.</p>
        </div>
        <div id="data-preview" class="hidden">
            <p>Data Preview (First 3 bookings):</p>
            <div class="data-box" id="data-preview-content"></div>
            <button id="copy-data">Copy All Data</button>
            <span id="copy-status" class="hidden success">Data copied to clipboard!</span>
        </div>
    </div>

    <div class="step hidden" id="step2">
        <div class="step-title">Step 2: Save Data (Backup)</div>
        <p>It's recommended to save this data somewhere safe as a backup:</p>
        <textarea id="json-backup" readonly></textarea>
        <button id="download-json">Download as JSON File</button>
    </div>

    <div class="step hidden" id="step3">
        <div class="step-title">Step 3: Transfer to Live Website</div>
        <p>Now, open your live website's admin page in another tab, then:</p>
        <ol>
            <li>Click on "Debug" in the upper right corner</li>
            <li>Click "Check localStorage" to see if there are already bookings</li>
            <li>Open your browser's developer console (F12 or right-click > Inspect > Console)</li>
            <li>Copy and paste the following code into the console:</li>
        </ol>
        <div class="data-box" id="transfer-code"></div>
        <button id="copy-code">Copy Code</button>
        <span id="code-copy-status" class="hidden success">Code copied to clipboard!</span>
    </div>

    <div class="step hidden" id="step4">
        <div class="step-title">Step 4: Verify Transfer</div>
        <p>After running the code on your live site:</p>
        <ol>
            <li>Click "Refresh Data" on your admin dashboard</li>
            <li>Verify that all your bookings appear</li>
            <li>If the bookings don't appear, try opening the debug panel and click "Check localStorage" to make sure the data was transferred</li>
        </ol>
    </div>

    <div class="log" id="log"></div>

    <script>
        // DOM Elements
        const extractBtn = document.getElementById('extract-data');
        const copyDataBtn = document.getElementById('copy-data');
        const downloadJsonBtn = document.getElementById('download-json');
        const copyCodeBtn = document.getElementById('copy-code');
        const bookingCount = document.getElementById('booking-count');
        const countValue = document.getElementById('count-value');
        const dataPreview = document.getElementById('data-preview');
        const dataPreviewContent = document.getElementById('data-preview-content');
        const copyStatus = document.getElementById('copy-status');
        const codeOutput = document.getElementById('transfer-code');
        const codeCopyStatus = document.getElementById('code-copy-status');
        const jsonBackup = document.getElementById('json-backup');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        const step4 = document.getElementById('step4');
        const logContainer = document.getElementById('log');

        // Variables
        let bookingData = null;
        let bookingsArray = [];

        // Add log entry
        function addLog(message) {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            const timestamp = new Date().toLocaleTimeString();
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Extract booking data from localStorage
        extractBtn.addEventListener('click', function() {
            try {
                addLog('Extracting booking data from localStorage...');
                bookingData = localStorage.getItem('adminBookings');
                
                if (!bookingData) {
                    addLog('WARNING: No adminBookings found in localStorage!');
                    bookingCount.classList.remove('hidden');
                    countValue.textContent = '0';
                    countValue.className = 'warning';
                    return;
                }

                bookingsArray = JSON.parse(bookingData);
                
                if (!Array.isArray(bookingsArray)) {
                    addLog('ERROR: adminBookings is not an array!');
                    bookingCount.classList.remove('hidden');
                    countValue.textContent = 'ERROR';
                    countValue.className = 'warning';
                    return;
                }

                // Display booking count
                bookingCount.classList.remove('hidden');
                countValue.textContent = bookingsArray.length;
                
                // Display data preview
                dataPreview.classList.remove('hidden');
                
                // Show first 3 bookings as preview
                const previewBookings = bookingsArray.slice(0, 3);
                dataPreviewContent.textContent = JSON.stringify(previewBookings, null, 2);
                
                // Show step 2
                step2.classList.remove('hidden');
                
                // Populate JSON backup
                jsonBackup.value = JSON.stringify(bookingsArray, null, 2);
                
                // Generate transfer code
                const transferCode = `
// Booking transfer script from local environment
(function() {
    try {
        // The booking data to transfer
        const bookingData = ${JSON.stringify(bookingsArray)};
        
        // Check if we already have bookings
        let existingBookings = [];
        const existingData = localStorage.getItem('adminBookings');
        
        if (existingData) {
            try {
                existingBookings = JSON.parse(existingData);
                console.log('Found ' + existingBookings.length + ' existing bookings');
            } catch (e) {
                console.error('Error parsing existing bookings:', e);
                existingBookings = [];
            }
        }
        
        // Merge existing and new bookings (avoid duplicates by booking reference)
        const bookingRefs = new Set(existingBookings.map(b => b.bookingReference));
        
        let newBookingsCount = 0;
        bookingData.forEach(booking => {
            if (!bookingRefs.has(booking.bookingReference)) {
                existingBookings.push(booking);
                bookingRefs.add(booking.bookingReference);
                newBookingsCount++;
            }
        });
        
        // Save merged data
        localStorage.setItem('adminBookings', JSON.stringify(existingBookings));
        console.log('Successfully transferred ' + newBookingsCount + ' new bookings. Total bookings: ' + existingBookings.length);
        
        // Refresh the page to show new data
        if (confirm('Booking data transferred successfully. Refresh the page to see the bookings?')) {
            window.location.reload();
        }
    } catch (e) {
        console.error('Error transferring bookings:', e);
        alert('Error transferring bookings: ' + e.message);
    }
})();`;
                
                codeOutput.textContent = transferCode.trim();
                
                // Show step 3
                step3.classList.remove('hidden');
                
                // Show step 4
                step4.classList.remove('hidden');
                
                addLog(`Successfully extracted ${bookingsArray.length} bookings.`);
            } catch (e) {
                addLog(`ERROR: ${e.message}`);
                console.error(e);
            }
        });

        // Copy booking data to clipboard
        copyDataBtn.addEventListener('click', function() {
            if (!bookingData) return;
            
            try {
                addLog('Copying booking data to clipboard...');
                
                navigator.clipboard.writeText(bookingData).then(function() {
                    copyStatus.classList.remove('hidden');
                    setTimeout(() => copyStatus.classList.add('hidden'), 2000);
                    addLog('Booking data copied to clipboard.');
                }, function(err) {
                    addLog(`ERROR: Could not copy data: ${err}`);
                });
            } catch (e) {
                addLog(`ERROR: ${e.message}`);
                console.error(e);
            }
        });

        // Copy transfer code to clipboard
        copyCodeBtn.addEventListener('click', function() {
            try {
                addLog('Copying transfer code to clipboard...');
                
                navigator.clipboard.writeText(codeOutput.textContent).then(function() {
                    codeCopyStatus.classList.remove('hidden');
                    setTimeout(() => codeCopyStatus.classList.add('hidden'), 2000);
                    addLog('Transfer code copied to clipboard.');
                }, function(err) {
                    addLog(`ERROR: Could not copy code: ${err}`);
                });
            } catch (e) {
                addLog(`ERROR: ${e.message}`);
                console.error(e);
            }
        });

        // Download JSON file
        downloadJsonBtn.addEventListener('click', function() {
            if (!bookingData) return;
            
            try {
                addLog('Preparing JSON file for download...');
                
                const blob = new Blob([bookingData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'admin-bookings-backup-' + new Date().toISOString().slice(0, 10) + '.json';
                a.click();
                
                URL.revokeObjectURL(url);
                addLog('JSON file download initiated.');
            } catch (e) {
                addLog(`ERROR: ${e.message}`);
                console.error(e);
            }
        });

        // Init
        addLog('Booking Transfer Tool initialized. Click "Extract Data" to begin.');
    </script>
</body>
</html> 