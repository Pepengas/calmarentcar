<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Local Storage</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        .storage-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .storage-item {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .item-name {
            font-weight: 600;
            margin-bottom: 10px;
            color: #1a73e8;
        }
        pre {
            background-color: #f3f4f6;
            padding: 10px;
            border-radius: 4px;
            overflow: auto;
            font-size: 14px;
            max-height: 400px;
        }
        button {
            background-color: #1a73e8;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #1557b0;
        }
        .actions {
            margin-bottom: 20px;
        }
        .debug-log {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f4f8;
            border-radius: 6px;
            max-height: 200px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <h1>LocalStorage Debug Tool</h1>
    
    <div class="actions">
        <button id="refresh">Refresh</button>
        <button id="add-test">Add Test Booking</button>
        <button id="clear-admin">Clear Admin Bookings</button>
    </div>
    
    <div class="debug-log" id="debug-log">
        <div>Log messages will appear here...</div>
    </div>
    
    <div class="storage-items" id="storage-container"></div>

    <script>
        // Function to display localStorage contents
        function displayLocalStorage() {
            const container = document.getElementById('storage-container');
            container.innerHTML = '';
            
            // Add log
            addLog('Refreshing localStorage display');
            
            // Get all items in localStorage
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                let value = localStorage.getItem(key);
                let formattedValue = value;
                
                // Try to pretty print JSON
                try {
                    const parsed = JSON.parse(value);
                    formattedValue = JSON.stringify(parsed, null, 2);
                    
                    // Add log
                    if (key === 'adminBookings') {
                        const bookings = parsed;
                        addLog(`Found ${bookings.length} admin bookings`);
                        
                        if (bookings.length > 0) {
                            bookings.forEach((booking, index) => {
                                addLog(`Booking ${index + 1}: Ref=${booking.bookingReference || 'N/A'}, Status=${booking.status || 'N/A'}`);
                            });
                        }
                    }
                } catch (e) {
                    // Not JSON, keep as is
                }
                
                // Create item card
                const item = document.createElement('div');
                item.className = 'storage-item';
                item.innerHTML = `
                    <div class="item-name">${key}</div>
                    <pre>${formattedValue}</pre>
                `;
                container.appendChild(item);
            }
        }
        
        // Add a log message
        function addLog(message) {
            const log = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }
        
        // Add a test booking
        function addTestBooking() {
            addLog('Adding test booking...');
            
            const testBooking = {
                bookingReference: 'TEST-' + Math.floor(Math.random() * 10000),
                status: 'confirmed',
                timestamp: new Date().toISOString(),
                customer: {
                    firstName: 'Test',
                    lastName: 'User',
                    email: 'test@example.com',
                    phone: '+1234567890',
                    additionalOptions: {
                        fullInsurance: true,
                        gpsNavigation: true
                    }
                },
                selectedCar: {
                    make: 'Toyota',
                    model: 'Corolla',
                    price: 45
                },
                pickupLocation: 'airport',
                dropoffLocation: 'port',
                pickupDate: new Date().toISOString(),
                returnDate: new Date(Date.now() + 3*24*60*60*1000).toISOString(),
                durationDays: 3,
                totalPrice: 135
            };
            
            // Get existing bookings
            let adminBookings = [];
            try {
                const existing = localStorage.getItem('adminBookings');
                if (existing) {
                    adminBookings = JSON.parse(existing);
                    addLog(`Found ${adminBookings.length} existing bookings`);
                }
            } catch (e) {
                addLog(`Error parsing existing bookings: ${e.message}`);
                adminBookings = [];
            }
            
            // Add new booking
            adminBookings.push(testBooking);
            
            // Save back to localStorage
            localStorage.setItem('adminBookings', JSON.stringify(adminBookings));
            addLog(`Test booking ${testBooking.bookingReference} added successfully`);
            
            // Refresh display
            displayLocalStorage();
        }
        
        // Clear admin bookings
        function clearAdminBookings() {
            if (confirm('Are you sure you want to clear all admin bookings?')) {
                localStorage.removeItem('adminBookings');
                addLog('Cleared all admin bookings');
                displayLocalStorage();
            }
        }
        
        // Set up event listeners
        document.getElementById('refresh').addEventListener('click', displayLocalStorage);
        document.getElementById('add-test').addEventListener('click', addTestBooking);
        document.getElementById('clear-admin').addEventListener('click', clearAdminBookings);
        
        // Initialize
        displayLocalStorage();
    </script>
</body>
</html> 