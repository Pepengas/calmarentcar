<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personal Information - Calma Car Rental</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Add Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- Add jQuery UI CSS -->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <!-- Add Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <!-- Add jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Add jQuery UI -->
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
  <!-- Add Select2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- Add Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    /* Reset and base styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      color: #333;
      line-height: 1.5;
      background-color: #f5f7fa;
    }
    
    /* Datalist styling (as much as browsers allow) */
    input[list] {
      padding: 0.9rem 1rem;
      width: 100%;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background-color: #f9f9f9;
    }
    
    input[list]:focus {
      border-color: #0066cc;
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.15);
      background-color: #fff;
    }
    
    /* Header */
    header {
      border-bottom: 1px solid #eee;
      padding: 1rem 0;
      background-color: #fff;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-weight: 700;
    }
    
    .logo a {
      color: #0066cc;
      text-decoration: none;
      transition: color 0.2s ease;
    }
    
    .logo a:hover {
      color: #004c99;
    }
    
    .nav-menu {
      display: flex;
      list-style: none;
    }
    
    .nav-menu li {
      margin-left: 1.5rem;
    }
    
    .nav-menu a {
      color: #333;
      text-decoration: none;
      font-size: 0.95rem;
      position: relative;
      transition: color 0.2s ease;
      padding: 0.5rem 0;
    }
    
    .nav-menu a:hover {
      color: #0066cc;
    }
    
    .nav-menu a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background-color: #0066cc;
      transition: width 0.3s ease;
    }
    
    .nav-menu a:hover::after {
      width: 100%;
    }
    
    /* Main content */
    .content {
      padding: 2.5rem 0;
    }
    
    h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: #0066cc;
      text-align: center;
      position: relative;
      padding-bottom: 0.5rem;
    }
    
    h1::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background-color: #0066cc;
      border-radius: 3px;
    }
    
    .back-link {
      display: inline-flex;
      align-items: center;
      color: #0066cc;
      text-decoration: none;
      margin-bottom: 2rem;
      font-size: 1rem;
      transition: color 0.2s ease;
      font-weight: 500;
    }
    
    .back-link:hover {
      color: #004c99;
    }
    
    .back-link::before {
      content: "←";
      margin-right: 0.5rem;
      transition: transform 0.2s ease;
    }
    
    .back-link:hover::before {
      transform: translateX(-4px);
    }
    
    /* Booking summary */
    #booking-summary {
      background-color: #fff;
      border-left: 4px solid #0066cc;
      padding: 1.75rem;
      border-radius: 8px;
      margin-bottom: 2.5rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    #booking-summary:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }
    
    .summary-title {
      font-weight: 700;
      margin-bottom: 1.25rem;
      font-size: 1.2rem;
      color: #0066cc;
      display: flex;
      align-items: center;
    }
    
    .summary-title::before {
      content: '\f5de';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      margin-right: 10px;
      color: #0066cc;
    }
    
    .summary-content {
      background-color: #f8f9fa;
      padding: 1.25rem;
      border-radius: 6px;
    }
    
    .summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px dashed #e0e0e0;
    }
    
    .summary-label {
      font-weight: 600;
      color: #555;
    }
    
    .summary-value {
      font-weight: 500;
      color: #0066cc;
    }

    .summary-section {
      margin-top: 1.25rem;
      border-top: 2px solid #e0e0e0;
      padding-top: 1.25rem;
    }

    .summary-section h4 {
      margin-bottom: 0.75rem;
      font-size: 1.1rem;
      color: #444;
      font-weight: 600;
    }

    .summary-item.total {
      margin-top: 1.25rem;
      padding-top: 0.75rem;
      border-top: 2px solid #0066cc;
      border-bottom: none;
      font-size: 1.2rem;
      font-weight: bold;
      color: #222;
    }
    
    .summary-item.total .summary-value {
      font-size: 1.3rem;
      font-weight: 700;
      color: #0066cc;
    }
    
    /* Selected car */
    .selected-car {
      display: flex;
      background-color: white;
      border-radius: 8px;
      padding: 1.25rem;
      margin-top: 1.25rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease;
    }
    
    .selected-car:hover {
      transform: translateY(-3px);
    }
    
    .selected-car-image {
      width: 100px;
      height: 70px;
      margin-right: 1.25rem;
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .selected-car-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.4s ease;
    }
    
    .selected-car:hover .selected-car-image img {
      transform: scale(1.05);
    }
    
    .selected-car-details h4 {
      font-size: 1.1rem;
      margin-bottom: 0.25rem;
      color: #0066cc;
    }
    
    .selected-car-details .car-category {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
    }
    
    .selected-car-details .car-category::before {
      content: '\f1b9';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      margin-right: 5px;
      color: #777;
    }
    
    /* Form styles */
    .personal-info-form {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      margin-bottom: 2rem;
    }
    
    .personal-info-form:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
    }
    
    .form-header {
      background-color: #0066cc;
      padding: 1.5rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      color: white;
    }
    
    .form-header h2 {
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0;
      display: flex;
      align-items: center;
    }
    
    .form-header h2::before {
      content: '\f2bb';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      margin-right: 10px;
    }
    
    .form-body {
      padding: 2rem 1.75rem;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
      position: relative;
    }
    
    .form-group.full-width {
      grid-column: span 2;
    }
    
    .form-group label {
      display: block;
      font-size: 0.95rem;
      font-weight: 500;
      margin-bottom: 0.6rem;
      color: #444;
      transition: color 0.3s ease;
    }
    
    .form-group label.required::after {
      content: '*';
      color: #e51c23;
      margin-left: 0.25rem;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.9rem 1rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background-color: #f9f9f9;
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      border-color: #0066cc;
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.15);
      background-color: #fff;
    }
    
    .form-group:hover label {
      color: #0066cc;
    }
    
    .form-group .hint {
      font-size: 0.85rem;
      color: #777;
      margin-top: 0.6rem;
      padding-left: 0.2rem;
      display: flex;
      align-items: center;
    }
    
    .form-group .hint::before {
      content: '\f05a';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      margin-right: 5px;
      color: #0066cc;
    }
    
    .form-group .validation-message {
      font-size: 0.85rem;
      color: #e51c23;
      margin-top: 0.5rem;
      min-height: 20px;
      display: flex;
      align-items: center;
    }
    
    .form-group.error .validation-message::before {
      content: '\f071';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      margin-right: 5px;
    }
    
    .form-group.error input,
    .form-group.error textarea,
    .form-group.error select {
      border-color: #e51c23;
      background-color: rgba(229, 28, 35, 0.03);
    }
    
    .form-check {
      display: flex;
      align-items: flex-start;
      margin-bottom: 1.25rem;
      padding: 0.5rem;
      border-radius: 6px;
      transition: background-color 0.2s ease;
    }
    
    .form-check:hover {
      background-color: rgba(0, 102, 204, 0.05);
    }
    
    .form-check input[type="checkbox"] {
      margin-right: 0.75rem;
      margin-top: 0.25rem;
      width: auto;
      accent-color: #0066cc;
      transform: scale(1.2);
    }
    
    .form-actions {
      display: flex;
      justify-content: space-between;
      padding: 1.5rem;
      border-top: 1px solid #eee;
      background-color: #f8f9fa;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.9rem 1.75rem;
      border-radius: 6px;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      font-size: 1rem;
      gap: 0.5rem;
    }
    
    .btn-primary {
      background-color: #0066cc;
      color: white;
      box-shadow: 0 4px 10px rgba(0, 102, 204, 0.25);
    }
    
    .btn-primary:hover {
      background-color: #0055aa;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 102, 204, 0.3);
    }
    
    .btn-secondary {
      background-color: #f2f2f2;
      color: #333;
      border: 1px solid #ddd;
    }
    
    .btn-secondary:hover {
      background-color: #e6e6e6;
      transform: translateY(-2px);
    }
    
    /* Terms and conditions link */
    .form-check a {
      color: #0066cc;
      text-decoration: none;
      position: relative;
      transition: color 0.2s ease;
    }
    
    .form-check a::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 1px;
      background-color: #0066cc;
      transition: height 0.2s ease;
    }
    
    .form-check a:hover {
      color: #004c99;
    }
    
    .form-check a:hover::after {
      height: 2px;
    }
    
    /* Loading indicator */
    #loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #loading-overlay .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 4px solid #fff;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Modal styling */
    #terms-modal.modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
    }
    
    #terms-modal .modal-content {
      background: white;
      margin: 10% auto;
      padding: 2rem;
      width: 80%;
      max-width: 700px;
      border-radius: 12px;
      max-height: 80%;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      animation: modalFadeIn 0.3s ease;
    }
    
    @keyframes modalFadeIn {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    #terms-modal .close-modal {
      float: right;
      font-size: 28px;
      cursor: pointer;
      color: #999;
      transition: color 0.2s ease;
    }
    
    #terms-modal .close-modal:hover {
      color: #333;
    }
    
    #terms-modal h2 {
      color: #0066cc;
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
      position: relative;
      padding-bottom: 0.5rem;
    }
    
    #terms-modal h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 60px;
      height: 3px;
      background-color: #0066cc;
      border-radius: 3px;
    }
    
    #terms-modal h3 {
      color: #444;
      margin: 1.5rem 0 0.75rem;
      font-size: 1.2rem;
    }
    
    #terms-modal p {
      margin-bottom: 1rem;
      line-height: 1.6;
      color: #555;
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .form-group.full-width {
        grid-column: span 1;
      }
      
      .form-actions {
        flex-direction: column;
        gap: 1rem;
      }
      
      .form-actions .btn {
        width: 100%;
      }
      
      h1 {
        font-size: 1.6rem;
      }
      
      .form-header h2 {
        font-size: 1.3rem;
      }
      
      #terms-modal .modal-content {
        padding: 1.5rem;
        margin: 15% auto;
        width: 90%;
      }
    }
    
    @media (max-width: 480px) {
      .form-body {
        padding: 1.5rem 1.25rem;
      }
      
      .form-actions {
        padding: 1.25rem;
      }
      
      .btn {
        padding: 0.8rem 1.5rem;
      }
    }
    
    /* Select2 custom styling */
    .select2-container--default .select2-selection--single {
      height: auto;
      padding: 0.6rem 0.8rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      background-color: #f9f9f9;
    }
    
    .select2-container--default .select2-selection--single:focus,
    .select2-container--default.select2-container--focus .select2-selection--single {
      border-color: #0066cc;
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.15);
    }
    
    .select2-container--default .select2-selection--single .select2-selection__rendered {
      color: #333;
      line-height: 1.5;
    }
    
    .select2-container--default .select2-selection--single .select2-selection__arrow {
      height: 100%;
    }
    
    .select2-dropdown {
      border-color: #ddd;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border-radius: 0 0 6px 6px;
      z-index: 99999 !important;
    }
    
    .select2-container--open .select2-dropdown--below {
      margin-top: 2px;
    }
    
    .select2-results__option {
      padding: 8px 12px;
      transition: background-color 0.2s;
    }
    
    .select2-container--default .select2-results__option--highlighted[aria-selected] {
      background-color: #0066cc;
    }
    
    .select2-search--dropdown .select2-search__field {
      padding: 8px;
      border-color: #ddd;
    }
    
    .select2-search--dropdown .select2-search__field:focus {
      border-color: #0066cc;
      outline: none;
    }
    
    /* Datepicker custom styling */
    .ui-datepicker {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      padding: 10px;
      width: 300px;
      border: none;
    }
    
    .ui-datepicker .ui-datepicker-header {
      background: #0066cc;
      color: white;
      border-radius: 6px 6px 0 0;
      border: none;
    }
    
    .ui-datepicker .ui-datepicker-title {
      font-weight: 600;
    }
    
    .ui-datepicker .ui-datepicker-prev,
    .ui-datepicker .ui-datepicker-next {
      cursor: pointer;
      top: 8px;
    }
    
    .ui-datepicker .ui-datepicker-prev:hover,
    .ui-datepicker .ui-datepicker-next:hover {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      top: 8px;
    }
    
    .ui-datepicker .ui-datepicker-calendar {
      margin-top: 5px;
    }
    
    .ui-datepicker .ui-datepicker-calendar th {
      font-weight: 500;
      color: #555;
    }
    
    .ui-datepicker .ui-datepicker-calendar td {
      padding: 2px;
    }
    
    .ui-datepicker .ui-datepicker-calendar td a.ui-state-default {
      text-align: center;
      background: #f9f9f9;
      border-radius: 4px;
      border: 1px solid #eee;
      color: #333;
      font-weight: normal;
    }
    
    .ui-datepicker .ui-datepicker-calendar td a.ui-state-default:hover {
      background: #e8f2ff;
      border-color: #a4ccf9;
    }
    
    .ui-datepicker .ui-datepicker-calendar td a.ui-state-active {
      background: #0066cc;
      color: white;
      border-color: #0066cc;
    }
    
    .ui-datepicker .ui-datepicker-buttonpane button {
      font-size: 0.9rem;
      padding: 5px 12px;
      margin: 5px;
      background: #f2f2f2;
      border: 1px solid #ddd;
      color: #333;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .ui-datepicker .ui-datepicker-buttonpane button:hover {
      background: #e6e6e6;
    }

    /* Month/Year Dropdown Styling */
    .ui-datepicker select.ui-datepicker-month,
    .ui-datepicker select.ui-datepicker-year {
      width: 45%;
      height: 2rem;
      background-color: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 4px;
      color: #333;
      font-weight: 500;
      margin: 0 2px;
      font-size: 0.9rem;
      padding: 0 0.5rem;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg>');
      background-repeat: no-repeat;
      background-position: right 8px center;
      cursor: pointer;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      transition: all 0.2s ease;
    }

    .ui-datepicker select.ui-datepicker-month:hover,
    .ui-datepicker select.ui-datepicker-year:hover {
      background-color: white;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    }

    .ui-datepicker select.ui-datepicker-month:focus,
    .ui-datepicker select.ui-datepicker-year:focus {
      outline: none;
      border: 1px solid #0066cc;
      background-color: white;
    }

    /* For Firefox */
    .ui-datepicker select.ui-datepicker-month::-moz-focus-inner,
    .ui-datepicker select.ui-datepicker-year::-moz-focus-inner {
      border: 0;
    }

    /* For IE and Edge */
    .ui-datepicker select.ui-datepicker-month::-ms-expand,
    .ui-datepicker select.ui-datepicker-year::-ms-expand {
      display: none;
    }
    
    /* Footer styles */
    footer {
      background-color: #f8f9fa;
      padding: 3rem 0 1.5rem;
      border-top: 1px solid #eee;
      margin-top: 3rem;
    }
    
    .footer-content {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-bottom: 2rem;
    }
    
    .footer-column {
      flex: 1;
      min-width: 200px;
      margin-right: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .footer-column h3 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
      position: relative;
      padding-bottom: 0.5rem;
    }
    
    .footer-column h3::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      width: 30px;
      height: 2px;
      background-color: #0066cc;
    }
    
    .footer-column ul {
      list-style: none;
      padding: 0;
    }
    
    .footer-column ul li {
      margin-bottom: 0.7rem;
    }
    
    .footer-column ul li a {
      color: #666;
      text-decoration: none;
      transition: color 0.2s;
      display: inline-flex;
      align-items: center;
    }
    
    .footer-column ul li a:hover {
      color: #0066cc;
    }
    
    .footer-column ul li a i {
      margin-right: 0.5rem;
      width: 16px;
    }
    
    .copyright {
      text-align: center;
      padding-top: 1.5rem;
      border-top: 1px solid #eee;
      color: #777;
      font-size: 0.9rem;
    }
    
    @media (max-width: 768px) {
      .footer-content {
        flex-direction: column;
      }
      
      .footer-column {
        margin-right: 0;
      }
    }

    /* Mobile-friendly add-ons and terms checkboxes */
    @media (max-width: 600px) {
      .form-check {
        margin-bottom: 0.7rem;
        padding: 0.6rem 0.7rem;
        border-radius: 8px;
        background: #f8f9fa;
        border: 1px solid #e0e0e0;
        font-size: 0.98rem;
      }
      .form-check input[type="checkbox"] {
        width: 1.1em;
        height: 1.1em;
        margin-right: 0.7em;
      }
      .form-group {
        margin-bottom: 0.8rem;
      }
      .form-group label, .form-check label {
        font-size: 1rem;
      }
      /* Group add-ons in a card */
      .addons-card {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        padding: 0.5rem 0.7rem 0.2rem 0.7rem;
        margin-bottom: 1.2rem;
      }
      /* 2x2 grid for add-ons on mobile */
      .addons-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.7rem;
      }
      .addons-card {
        padding: 0.7rem 0.5rem;
        margin-bottom: 0;
        min-width: 0;
      }
      .form-group {
        margin-bottom: 0.5rem;
      }
    }

    /* Add-ons grid: 4 in a row on desktop, 2x2 on mobile */
    .addons-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-bottom: 1.2rem;
    }
    .addons-card {
      padding: 1rem 0.7rem;
      margin-bottom: 0;
      min-width: 0;
      background: #f8f9fa;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }
    .addons-card label {
      font-size: 1.05rem;
    }
    .addons-card input[type="checkbox"] {
      width: 1.2em;
      height: 1.2em;
      margin-right: 0.7em;
    }
    @media (max-width: 600px) {
      .addons-grid {
        grid-template-columns: 1fr 1fr;
        gap: 0.7rem;
      }
      .addons-card {
        padding: 0.5rem 0.3rem;
      }
      .addons-card label {
        font-size: 0.97rem;
      }
      .addons-card input[type="checkbox"] {
        width: 1em;
        height: 1em;
        margin-right: 0.5em;
      }
    }
  </style>
  <!-- Add progress tracker CSS -->
  <link rel="stylesheet" href="assets/css/progress-tracker.css">
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container">
      <div class="header-content flex justify-between items-center w-full">
        <div class="logo flex-shrink-0">
          <a href="index.html" class="block">
            <img src="images/CalmaLogoTrans.png" alt="Calma Car Rental Logo" width="160" height="50">
          </a>
        </div>
        <nav class="hidden md:block">
          <ul class="nav-menu flex space-x-6">
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#cars">Our Cars</a></li>
            <li><a href="index.html#about">About Us</a></li>
            <li><a href="index.html#faq">FAQ</a></li>
            <li><a href="index.html#contact">Contact</a></li>
          </ul>
        </nav>
        <button class="mobile-menu md:hidden" aria-label="Open navigation menu">
          <i class="fas fa-bars" aria-hidden="true"></i>
        </button>
      </div>
    </div>
  </header>

  <div class="container content">
    <h1>Personal Information</h1>
    
    <a href="car-selection.html" class="back-link">Back to car selection</a>
    
    <!-- NEW Progress Tracker -->
    <div class="w-full max-w-2xl mx-auto mt-6 px-4">
      <div class="flex justify-between items-center text-sm md:text-base">
        <!-- Step 1 (completed) -->
        <div class="flex flex-col items-center flex-1">
          <div class="w-8 h-8 md:w-10 md:h-10 flex items-center justify-center rounded-full bg-blue-600 text-white font-bold">
            <span class="fas fa-check" style="font-size: 0.8rem;"></span>
          </div>
          <span class="mt-1 text-blue-600 font-semibold">Trip Details</span>
        </div>

        <div class="h-1 bg-blue-600 flex-1 mx-2"></div>

        <!-- Step 2 (completed) -->
        <div class="flex flex-col items-center flex-1">
          <div class="w-8 h-8 md:w-10 md:h-10 flex items-center justify-center rounded-full bg-blue-600 text-white font-bold">
            <span class="fas fa-check" style="font-size: 0.8rem;"></span>
          </div>
          <span class="mt-1 text-blue-600 font-semibold">Vehicle Selection</span>
        </div>

        <div class="h-1 bg-blue-600 flex-1 mx-2"></div>

        <!-- Step 3 (active) -->
        <div class="flex flex-col items-center flex-1">
          <div class="w-8 h-8 md:w-10 md:h-10 flex items-center justify-center rounded-full bg-blue-600 text-white font-bold">
            3
          </div>
          <span class="mt-1 text-blue-600 font-semibold">Personal Info</span>
        </div>
      </div>
    </div>
    
    <!-- Booking Summary -->
    <div id="booking-summary">
      <div class="summary-title">Your Trip Details</div>
      <div class="summary-content">
        <div class="summary-item">
          <span class="summary-label">Pickup Location:</span>
          <span class="summary-value" id="summary-location"></span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Drop-off Location:</span>
          <span class="summary-value" id="summary-dropoff-location"></span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Pickup Date:</span>
          <span class="summary-value" id="summary-pickup-date"></span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Return Date:</span>
          <span class="summary-value" id="summary-return-date"></span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Duration:</span>
          <span class="summary-value" id="summary-duration"></span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Selected Car:</span>
          <span class="summary-value" id="summary-car"></span>
        </div>
        <div class="summary-section">
          <h4>Additional Options</h4>
          <div id="additional-options-summary">
            <!-- Additional options will be added here by JavaScript -->
          </div>
        </div>
        <div class="summary-item total">
          <span class="summary-label">Total Price:</span>
          <span class="summary-value" id="summary-total"></span>
        </div>
      </div>
    </div>
    
    <!-- Personal Information Form -->
    <form id="customer-form" class="personal-info-form">
      <div class="form-header">
        <h2>Enter Your Details</h2>
      </div>
      
      <div class="form-body">
        <div class="form-grid">
          <div class="form-group">
            <label class="required">First Name</label>
            <input type="text" id="firstName" name="firstName" required>
            <div id="firstName-error" class="validation-message"></div>
          </div>
          
          <div class="form-group">
            <label class="required">Last Name</label>
            <input type="text" id="lastName" name="lastName" required>
            <div id="lastName-error" class="validation-message"></div>
          </div>
          
          <div class="form-group">
            <label class="required">Email Address</label>
            <input type="email" id="email" name="email" required>
            <div id="email-error" class="validation-message"></div>
          </div>
          
          <div class="form-group">
            <label class="required">Phone Number</label>
            <div style="display: flex; gap: 0.5rem; align-items: center;">
              <input type="text" id="phoneCountryCode" name="phoneCountryCode" value="+" maxlength="5" required style="width: 60px; text-align: center;" placeholder="+30">
              <input type="tel" id="phone" name="phone" required placeholder="Phone Number" style="flex: 1;">
            </div>
            <div id="phone-error" class="validation-message"></div>
          </div>
          
          <div class="form-group">
            <label class="required">Age</label>
            <input type="number" id="age" name="age" min="25" max="99" required>
            <div id="age-error" class="validation-message"></div>
            <div class="hint">You must be at least 25 years old to rent a car.</div>
          </div>
          
          <div class="form-group">
            <label class="required">Driver's License Number</label>
            <input type="text" id="driverLicense" name="driverLicense" required>
            <div id="driverLicense-error" class="validation-message"></div>
          </div>
          
          <div class="form-group">
            <label class="required">License Expiration Date</label>
            <input type="text" id="licenseExpiry" name="licenseExpiry" required 
                   placeholder="mm/dd/yyyy" readonly
                   style="cursor: pointer; background-image: url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22%23555555%22%3E%3Cpath d=%22M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z%22/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 10px center; background-size: 20px; padding-right: 35px;">
            <div id="licenseExpiry-error" class="validation-message"></div>
          </div>
          
          <div class="form-group">
            <label class="required">Country</label>
            <select id="nationality" name="nationality" class="form-control country-select" required></select>
            <div id="nationality-error" class="validation-message"></div>
          </div>
          
          <div class="form-group full-width">
            <label>Special Requests</label>
            <textarea id="specialRequests" name="specialRequests" rows="3"></textarea>
            <div id="specialRequests-error" class="validation-message"></div>
          </div>

          <div class="form-group">
            <div class="addons-grid">
              <div class="addons-card">
                <div class="form-check">
                  <input type="checkbox" id="additionalDriver" name="additionalDriver">
                  <label for="additionalDriver">Additional Driver (+€15/day)</label>
                </div>
              </div>
              <div class="addons-card">
                <div class="form-check">
                  <input type="checkbox" id="fullInsurance" name="fullInsurance">
                  <label for="fullInsurance">Full Insurance (+€25/day)</label>
                </div>
              </div>
              <div class="addons-card">
                <div class="form-check">
                  <input type="checkbox" id="gpsNavigation" name="gpsNavigation">
                  <label for="gpsNavigation">GPS Navigation (+€8/day)</label>
                </div>
              </div>
              <div class="addons-card">
                <div class="form-check">
                  <input type="checkbox" id="childSeat" name="childSeat">
                  <label for="childSeat">Child Seat (+€5/day)</label>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="form-check">
          <input type="checkbox" id="termsAccepted" name="termsAccepted" required>
          <label for="termsAccepted">I agree to the <a href="#" id="terms-link">Terms and Conditions</a> and <a href="#">Privacy Policy</a></label>
        </div>
        <div id="termsAccepted-error" class="validation-message"></div>
      </div>
      
      <div class="form-actions">
        <button type="button" id="back-btn" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back
        </button>
        <div class="form-group form-submit">
          <button type="submit" id="complete-booking-btn" class="btn btn-primary">
            Proceed to Payment <i class="fas fa-credit-card"></i>
          </button>
        </div>
      </div>
    </form>

    <!-- Terms and Conditions Modal -->
    <div id="terms-modal" class="modal">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Terms and Conditions</h2>
        <div class="terms-content">
          <h3>1. Rental Agreement</h3>
          <p>This agreement is between the customer ("you") and Calma Car Rental ("we" or "us").</p>
          
          <h3>2. Vehicle Use</h3>
          <p>The vehicle must only be driven by the person(s) named on this rental agreement and only if they hold a full valid driving license.</p>
          
          <h3>3. Insurance</h3>
          <p>Basic insurance is included in the rental price. This covers damage to the rental vehicle subject to an excess of €500.</p>
          
          <h3>4. Fuel Policy</h3>
          <p>The vehicle will be supplied with a full tank of fuel and should be returned with a full tank.</p>
          
          <h3>5. Cancellation Policy</h3>
          <p>Free cancellation up to 48 hours before pickup. Cancellations within 48 hours of pickup will be charged 50% of the total rental cost.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay">
    <div class="spinner"></div>
  </div>

  <!-- JavaScript -->
  <!-- <script src="assets/js/customer-info.js"></script> -->
  
  <!-- Country Selector Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize Select2 for country selection
      const countries = [
        "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", 
        "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", 
        "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", 
        "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China", "Colombia", 
        "Comoros", "Congo", "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti", "Dominica", 
        "Dominican Republic", "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", 
        "Ethiopia", "Fiji", "Finland", "France", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", 
        "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", 
        "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", 
        "Korea, North", "Korea, South", "Kosovo", "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", 
        "Libya", "Liechtenstein", "Lithuania", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", 
        "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", 
        "Morocco", "Mozambique", "Myanmar", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", 
        "Nigeria", "North Macedonia", "Norway", "Oman", "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", 
        "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", 
        "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", 
        "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", 
        "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", "Taiwan", 
        "Tajikistan", "Tanzania", "Thailand", "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", 
        "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", "Uruguay", 
        "Uzbekistan", "Vanuatu", "Vatican City", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
      ];
      
      // Populate the select with countries
      const $countrySelect = $('.country-select');
      $countrySelect.append('<option value="">Select a country</option>');
      
      countries.forEach(country => {
        $countrySelect.append(`<option value="${country}">${country}</option>`);
      });
      
      // Initialize Select2
      $countrySelect.select2({
        placeholder: "Search for a country...",
        allowClear: true,
        width: '100%',
        dropdownCssClass: 'country-dropdown',
        containerCssClass: 'country-container'
      });
      
      // Custom styling to ensure dropdown is visible
      $('.select2-dropdown').css('z-index', '99999');
      
      // Initialize datepicker for license expiration date
      $("#licenseExpiry").datepicker({
        dateFormat: 'mm/dd/yy',
        changeMonth: true,
        changeYear: true,
        yearRange: 'c:c+10', // Current year to 10 years in the future
        minDate: 0, // Cannot select dates in the past
        beforeShow: function(input, inst) {
          // Ensure the datepicker appears above everything
          setTimeout(function() {
            inst.dpDiv.css({
              'z-index': 100000
            });
          }, 0);
        }
      });
      
      console.log('Select2 country selector and datepicker initialized');
    });
  </script>
  
  <!-- Debug Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Set the correct progress step indicators
      const steps = document.querySelectorAll('.step');
      const stepTitles = document.querySelectorAll('.step-title');
      
      // Initialize progress steps
      function updateProgressSteps(currentStep) {
        steps.forEach((step, index) => {
          if (index + 1 === currentStep) {
            step.classList.add('active');
            step.classList.remove('completed');
          } else if (index + 1 < currentStep) {
            step.classList.add('completed');
            step.classList.remove('active');
          } else {
            step.classList.remove('active', 'completed');
          }
        });
        
        stepTitles.forEach((title, index) => {
          if (index + 1 === currentStep) {
            title.classList.add('active');
          } else {
            title.classList.remove('active');
          }
        });
      }
      
      // We're on step 3 (Personal Information)
      updateProgressSteps(3);
      
      // Handle back button click
      document.getElementById('back-btn').addEventListener('click', function() {
        window.location.href = 'car-selection.html';
      });
      
      // Add debug logging
      console.log('Debug script loaded');
      
      // Populate Trip Details from URL parameters or localStorage
      function populateTripDetails() {
        console.log('Populating trip details...');
        
        // Try to get data from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        
        // Get location information
        const pickupLocation = urlParams.get('pickup-location') || localStorage.getItem('pickupLocation') || '';
        const dropoffLocation = urlParams.get('dropoff-location') || localStorage.getItem('dropoffLocation') || pickupLocation;
        
        // Get date information
        const pickupDate = urlParams.get('pickup-date') || localStorage.getItem('pickupDate') || '';
        const pickupTime = urlParams.get('pickup-time') || localStorage.getItem('pickupTime') || '';
        const returnDate = urlParams.get('dropoff-date') || localStorage.getItem('returnDate') || '';
        const returnTime = urlParams.get('dropoff-time') || localStorage.getItem('returnTime') || '';
        
        // Calculate duration (inclusive, as on car selection page)
        let durationDays = 1;
        if (pickupDate && returnDate) {
          const pickup = new Date(pickupDate);
          const returnD = new Date(returnDate);
          durationDays = Math.ceil((returnD - pickup) / (1000 * 60 * 60 * 24)) + 1;
          if (durationDays < 1) durationDays = 1;
        }
        
        // Get car information
        let carName = urlParams.get('car-name') || '';
        let carMake = '';
        let carModel = '';
        let carPrice = 0;
        let totalPrice = 0;
        try {
          const storedCarData = JSON.parse(localStorage.getItem('selectedCar') || '{}');
          console.log('Loaded selectedCar from localStorage:', storedCarData);
          if (storedCarData) {
            carMake = carMake || storedCarData.make;
            carModel = carModel || storedCarData.model;
            if (storedCarData.price && storedCarData.price > 0) {
              carPrice = storedCarData.price;
            }
            if (storedCarData.totalPrice && storedCarData.totalPrice > 0) {
              totalPrice = storedCarData.totalPrice;
            }
          }
        } catch (e) {
          console.error('Error getting car data from localStorage:', e);
        }
        // If no totalPrice from storage, calculate
        if (!totalPrice && carPrice > 0 && durationDays > 0) {
          totalPrice = carPrice * durationDays;
        }
        console.log('Summary values:', {carMake, carModel, carPrice, durationDays, totalPrice});
        // Format dates for display
        function formatDate(dateStr, timeStr) {
          if (!dateStr) return 'N/A';
          
          try {
            const date = new Date(dateStr);
            const datePart = date.toLocaleDateString('en-US', {
              weekday: 'short',
              month: 'short',
              day: 'numeric',
              year: 'numeric'
            });
            
            return timeStr ? `${datePart}, ${timeStr}` : datePart;
          } catch (e) {
            console.error('Error formatting date:', e);
            return dateStr;
          }
        }
        
        // Format locations for display
        function formatLocation(location) {
          const locationMap = {
            'airport': 'Chania Airport',
            'port': 'Chania Port',
            'city': 'Chania City Center',
            'hotel': 'Your Hotel/Villa'
          };
          
          return locationMap[location] || location;
        }
        
        // Update summary elements
        document.getElementById('summary-location').textContent = formatLocation(pickupLocation);
        document.getElementById('summary-dropoff-location').textContent = formatLocation(dropoffLocation);
        document.getElementById('summary-pickup-date').textContent = formatDate(pickupDate, pickupTime);
        document.getElementById('summary-return-date').textContent = formatDate(returnDate, returnTime);
        document.getElementById('summary-duration').textContent = `${durationDays} day${durationDays > 1 ? 's' : ''}`;
        document.getElementById('summary-car').textContent = `${carMake} ${carModel}`;
        document.getElementById('summary-total').textContent = (totalPrice > 0) ? `€${totalPrice.toFixed(2)}` : 'N/A';
        
        console.log('Trip details populated successfully');
      }
      
      // Call the function when the page loads
      populateTripDetails();
      
      // Update total price when additional options are changed
      function updateTotalPrice() {
        // Get base price information
        const dailyRate = parseFloat(document.getElementById('summary-daily-rate').textContent.replace('€', '').replace('/day', '')) || 0;
        
        // Get duration
        const durationText = document.getElementById('summary-duration').textContent;
        const durationDays = parseInt(durationText.split(' ')[0]) || 1;
        
        // Calculate base price
        let totalPrice = dailyRate * durationDays;
        
        // Add costs for additional options
        const optionPrices = {
          additionalDriver: 15,
          fullInsurance: 25,
          gpsNavigation: 8,
          childSeat: 5
        };
        
        // Check which options are selected
        const additionalDriver = document.getElementById('additionalDriver').checked;
        const fullInsurance = document.getElementById('fullInsurance').checked;
        const gpsNavigation = document.getElementById('gpsNavigation').checked;
        const childSeat = document.getElementById('childSeat').checked;
        
        // Update additional options summary
        const additionalOptionsSummary = document.getElementById('additional-options-summary');
        additionalOptionsSummary.innerHTML = '';
        
        if (additionalDriver) {
          totalPrice += optionPrices.additionalDriver * durationDays;
          additionalOptionsSummary.innerHTML += `<div class="option-item">Additional Driver: €${(optionPrices.additionalDriver * durationDays).toFixed(2)}</div>`;
        }
        
        if (fullInsurance) {
          totalPrice += optionPrices.fullInsurance * durationDays;
          additionalOptionsSummary.innerHTML += `<div class="option-item">Full Insurance: €${(optionPrices.fullInsurance * durationDays).toFixed(2)}</div>`;
        }
        
        if (gpsNavigation) {
          totalPrice += optionPrices.gpsNavigation * durationDays;
          additionalOptionsSummary.innerHTML += `<div class="option-item">GPS Navigation: €${(optionPrices.gpsNavigation * durationDays).toFixed(2)}</div>`;
        }
        
        if (childSeat) {
          totalPrice += optionPrices.childSeat * durationDays;
          additionalOptionsSummary.innerHTML += `<div class="option-item">Child Seat: €${(optionPrices.childSeat * durationDays).toFixed(2)}</div>`;
        }
        
        if (!additionalDriver && !fullInsurance && !gpsNavigation && !childSeat) {
          additionalOptionsSummary.innerHTML = '<div class="option-item">None selected</div>';
        }
        
        // Update total price display
        document.getElementById('summary-total').textContent = `€${totalPrice.toFixed(2)}`;
      }
      
      // Add event listeners to additional options checkboxes
      const additionalOptions = ['additionalDriver', 'fullInsurance', 'gpsNavigation', 'childSeat'];
      additionalOptions.forEach(option => {
        const checkbox = document.getElementById(option);
        if (checkbox) {
          checkbox.addEventListener('change', updateTotalPrice);
        }
      });
      
      // Get form and button
      const form = document.getElementById('customer-form');
      const submitBtn = document.getElementById('complete-booking-btn');
      
      console.log('Form:', form);
      console.log('Submit button:', submitBtn);
      
      // Flag to prevent multiple submissions
      let isSubmitting = false;
      
      // Function to show success message
      function showSuccessMessage() {
        // Create a success message element if it doesn't exist
        let successMessage = document.getElementById('booking-success-message');
        if (!successMessage) {
          successMessage = document.createElement('div');
          successMessage.id = 'booking-success-message';
          successMessage.className = 'alert alert-success';
          successMessage.style.position = 'fixed';
          successMessage.style.top = '20px';
          successMessage.style.left = '50%';
          successMessage.style.transform = 'translateX(-50%)';
          successMessage.style.zIndex = '9999';
          successMessage.style.padding = '15px 25px';
          successMessage.style.borderRadius = '5px';
          successMessage.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
          successMessage.style.backgroundColor = '#dff0d8';
          successMessage.style.color = '#3c763d';
          successMessage.style.border = '1px solid #d6e9c6';
          document.body.appendChild(successMessage);
        }
        
        successMessage.innerHTML = '<i class="fas fa-check-circle"></i> Booking successful! Redirecting to confirmation page...';
        successMessage.style.display = 'block';
      }
      
      // Add a direct event listener to the submit button
      if (submitBtn) {
        submitBtn.addEventListener('click', function(e) {
          console.log('Submit button clicked from inline handler');
          
          // Prevent duplicate submissions
          if (isSubmitting) {
            console.log('Form is already being submitted, preventing duplicate submission');
            e.preventDefault();
            return;
          }
          
          // Force direct submission by collecting form data manually
          e.preventDefault();
          
          const firstName = document.getElementById('firstName').value;
          const lastName = document.getElementById('lastName').value;
          const email = document.getElementById('email').value;
          const phone = document.getElementById('phone').value;
          const driverLicense = document.getElementById('driverLicense').value;
          const licenseExpiry = document.getElementById('licenseExpiry').value;
          const age = document.getElementById('age').value;
          const nationality = document.getElementById('nationality').value;
          
          // Basic validation
          if (!firstName || !lastName || !email || !phone || !driverLicense || !licenseExpiry || !age || !nationality) {
            alert('Please fill in all required fields');
            return;
          }
          
          // Validate age (must be at least 25)
          if (parseInt(age) < 25) {
            alert('You must be at least 25 years old to rent a car');
            document.getElementById('age').focus();
            return;
          }
          
          // Check terms acceptance
          const termsAccepted = document.getElementById('termsAccepted').checked;
          if (!termsAccepted) {
            alert('Please accept the terms and conditions');
            return;
          }
          
          // Set submitting flag to prevent duplicate submissions
          isSubmitting = true;
          
          // Disable submit button to prevent multiple clicks
          submitBtn.disabled = true;
          submitBtn.classList.add('disabled');
          submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
          
          // Show loading overlay
          const loadingOverlay = document.getElementById('loading-overlay');
          if (loadingOverlay) {
            loadingOverlay.style.display = 'flex';
          }
          
          // Get URL parameters for booking data
          const urlParams = new URLSearchParams(window.location.search);
          const carName = urlParams.get('car-name') || '';
          const carMake = carName.split(' ')[0] || '';
          const carModel = carName.split(' ').slice(1).join(' ') || '';
          const carPrice = parseFloat(urlParams.get('car-price') || 0);
          
          // Get car data more reliably - try to get from local storage if URL params are missing
          let finalCarId = urlParams.get('car-id') || '';
          let finalCarMake = carMake;
          let finalCarModel = carModel; 
          let finalDailyRate = carPrice;
          try {
            const storedCarData = JSON.parse(localStorage.getItem('selectedCar'));
            if (storedCarData) {
              finalCarId = finalCarId || storedCarData.id;
              finalCarMake = finalCarMake || storedCarData.make;
              finalCarModel = finalCarModel || storedCarData.model;
              finalDailyRate = finalDailyRate || storedCarData.price;
              console.log('Retrieved car data from localStorage:', storedCarData);
            }
          } catch (e) {
            console.error('Error retrieving car data from localStorage:', e);
          }
          // Calculate total price based on duration and selected car
          const durationDays = parseInt(urlParams.get('duration') || 1);
          // Fetch total price from backend before submitting
          const fetchTotalPrice = async () => {
            const carId = finalCarId;
            const pickupDate = urlParams.get('pickup-date');
            const returnDate = urlParams.get('dropoff-date');
            if (!carId || !pickupDate || !returnDate) return 0;
            // Calculate month and days
            const pickupMonth = new Date(pickupDate).toISOString().slice(0, 7);
            const pickup = new Date(pickupDate);
            const dropoff = new Date(returnDate);
            const days = Math.ceil((dropoff - pickup) / (1000 * 60 * 60 * 24)) + 1;
            try {
              const resp = await fetch(`/api/get-price?car_id=${encodeURIComponent(carId)}&month=${encodeURIComponent(pickupMonth)}&days=${days}`);
              const data = await resp.json();
              if (data.success && data.total_price) return data.total_price;
              return 0;
            } catch (e) {
              return 0;
            }
          };
          fetchTotalPrice().then(async (basePrice) => {
            let totalPrice = basePrice;
            // Check additional options
            const additionalDriver = document.getElementById('additionalDriver').checked;
            const fullInsurance = document.getElementById('fullInsurance').checked;
            const gpsNavigation = document.getElementById('gpsNavigation').checked;
            const childSeat = document.getElementById('childSeat').checked;
            // Add additional options costs
            if (additionalDriver) totalPrice += 15 * durationDays;
            if (fullInsurance) totalPrice += 25 * durationDays;
            if (gpsNavigation) totalPrice += 8 * durationDays;
            if (childSeat) totalPrice += 5 * durationDays;
            console.log('Fetched totalPrice before booking:', totalPrice);
            if (!totalPrice || totalPrice <= 0) {
              alert('Could not fetch price for this car and dates. Please try again or contact support.');
              resetSubmitButton();
              return;
            }
            // Create booking data with snake_case field names for server
            const bookingData = {
              car_id: finalCarId,
              customer_first_name: firstName,
              customer_last_name: lastName,
              customer_email: email,
              customer_phone: phone,
              driver_license: driverLicense,
              license_expiration: licenseExpiry,
              customer_age: age,
              country: nationality,
              pickup_date: urlParams.get('pickup-date'),
              return_date: urlParams.get('dropoff-date'),
              pickup_location: urlParams.get('pickup-location'),
              dropoff_location: urlParams.get('dropoff-location'),
              car_make: finalCarMake,
              car_model: finalCarModel,
              daily_rate: Math.round(basePrice / durationDays),
              total_price: totalPrice,
              additional_driver: additionalDriver,
              full_insurance: fullInsurance,
              gps_navigation: gpsNavigation,
              child_seat: childSeat,
              special_requests: document.getElementById('specialRequests').value
            };
            console.log('FINAL booking payload to send:', bookingData);
            
            // Button is already disabled above, and loading overlay already shown
            
            fetch("/api/bookings", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(bookingData)
            })
            .then(async (response) => {
              const contentType = response.headers.get("content-type");
              const rawBody = await response.clone().text();
              
              console.log(`Booking API response status: ${response.status} ${response.statusText}`);
              console.log('Raw response body:', rawBody);
            
              if (!response.ok) {
                throw new Error(`Booking failed. Status: ${response.status}. Message: ${rawBody}`);
              }
            
              if (!contentType || !contentType.includes("application/json")) {
                throw new Error(`Unexpected response format. Raw body: ${rawBody}`);
              }
            
              const data = await response.json();
              if (!data.success) {
                throw new Error(`Booking failed. Server responded: ${JSON.stringify(data)}`);
              }
            
              // Show success message
              showSuccessMessage();
                
              // Redirect after a short delay
              setTimeout(() => {
                window.location.href = `booking-confirmation.html?reference=${data.booking_reference}`;
              }, 1000);
            })
            .catch((error) => {
              console.error('Booking error:', error);
              alert(`Booking error: ${error.message}`);
              resetSubmitButton();
            })
            .finally(() => {
              isSubmitting = false;
            });
          });
        });
      }
      
      // Handle terms and conditions modal
      const termsLink = document.getElementById('terms-link');
      const termsModal = document.getElementById('terms-modal');
      const closeModal = document.querySelector('.close-modal');
      
      if (termsLink && termsModal) {
        termsLink.addEventListener('click', function(e) {
          e.preventDefault();
          termsModal.style.display = 'block';
        });
        
        closeModal.addEventListener('click', function() {
          termsModal.style.display = 'none';
        });
        
        window.addEventListener('click', function(e) {
          if (e.target === termsModal) {
            termsModal.style.display = 'none';
          }
        });
      }
      
      // Add resetSubmitButton function to re-enable the button and hide overlay
      function resetSubmitButton() {
        isSubmitting = false;
        submitBtn.disabled = false;
        submitBtn.classList.remove('disabled');
        submitBtn.innerHTML = 'Proceed to Payment <i class="fas fa-credit-card"></i>';
        const loadingOverlay = document.getElementById('loading-overlay');
        if (loadingOverlay) {
          loadingOverlay.style.display = 'none';
        }
      }
    });
  </script>
  <script src="assets/js/mobile-menu.js"></script>
  
  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-column">
          <h3>Calma Car Rental</h3>
          <ul>
            <li><a href="index.html#about">About Us</a></li>
            <li><a href="index.html#cars">Our Fleet</a></li>
            <li><a href="index.html#additional">Terms & Conditions</a></li>
          </ul>
        </div>
        
        <div class="footer-column">
          <h3>Support</h3>
          <ul>
            <li><a href="index.html#faq">FAQ</a></li>
            <li><a href="index.html#contact">Contact Us</a></li>
            <li><a href="#">Privacy Policy</a></li>
          </ul>
        </div>
        
        <div class="footer-column">
          <h3>Connect with Us</h3>
          <ul>
            <li><a href="#"><i class="fab fa-facebook"></i> Facebook</a></li>
            <li><a href="#"><i class="fab fa-instagram"></i> Instagram</a></li>
            <li><a href="#"><i class="fab fa-twitter"></i> Twitter</a></li>
          </ul>
        </div>
      </div>
      
      <div class="copyright">
        <p>&copy; 2023 Calma Car Rental. All rights reserved.</p>
      </div>
    </div>
  </footer>
</body>
</html>